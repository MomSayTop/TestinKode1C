//Проверка на остатки при проведении

Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
|Ссылка.Склад КАК Склад,
|Номенклатура,
|ЕдиницаИзмерения,
|Сумма(Количество),
|Поместить ВТ_Основная
|ИЗ 
|Документ.РеализацияТовараИУслуг.Товары
|ГДЕ
|Ссылка = &Ссылка
|Сгруппировать ПО
|Ссылка.Склад,
|Номенклатура,
|ЕдиницаИзмерения
|
|;
|
|ВЫБРАТЬ
|ВТ_Товары.Номенклатура,
|ВТ_Товары.ЕдиницаИзмерения,
|ВТ_Товары.Количество
|ИЗ
|ВТ_Товары
|ЛЕВОЕ СОЕДИНЕНИЕ
|РегистрНакопления.ТоварыНаСкладах.Остатки() КАК Остатки
|ПО ВТ_Товары.Номенклатур = Остатки.Номенклатура
|И ВТ_Товары.ЕдиницаИзмерения = Остатки.ЕдиницаИзмерения
|И ВТ_Товары.Склад = Остатки.Склад
|ИМЕЮЩИЕ
|ВТ_Товары.Количество > Остатки.КоличествоОстаток
|";

Запрос.УстановитьПараметр("Ссылка",ЭтотОбъект.Ссылка);
Результат = Запрос.Выполнить();
 
 Выборка = Результат.Выбрать();
 Пока Выборка.Следующий() Цикл
  ШаблонТекст = СтрШаблон("Отказ в проведении. Товар %1: запрашивается %2, в наличии на складе %3",
  Выборка.Номенклатура, Выборка.Количество, Выборка.КоличествоОстаток);
  Отказ = Истина;
 КонецЦикла;
  
